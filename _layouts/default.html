<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ page.title | default: "Research With Consent" }}</title>
  <style>
    /* --- Base / global --- */
    *, *::before, *::after { box-sizing: border-box; }

    body {
      font-family: Calibri, sans-serif;
      background-color: #eae6df;
      margin: 0;
      padding: 0;
    }

    /* Responsive type */
    h1 { font-size: clamp(1.8rem, 5.5vw, 2.4rem); text-align: center; margin: .4em 0 .2em; }
    h2 { font-size: clamp(1.4rem, 4.5vw, 2rem);   text-align: center; margin: .3em 0 .4em; }
    h3 { font-size: clamp(1.2rem, 4vw, 1.6rem);   text-align: center; margin: .25em 0 .4em; }
    p  { font-size: clamp(1rem, 2.8vw, 1.2rem);   margin: .6em 0; }

    img, svg, video { max-width: 100%; height: auto; display: block; }

    /* Only force-wrap when needed */
    .wrap-long { overflow-wrap:anywhere; word-break:break-word;}

    /* Section layout */
    .main-section{
      max-width: 1100px;
      margin-inline: auto;
      padding-block: clamp(12px, 3vw, 28px);
    }
    .main-section p{ max-width: 75ch; margin-left:auto; margin-right:auto; }
    .main-section > :first-child{ margin-top:0; }
    .main-section > :last-child { margin-bottom:0; }

    header {
      background-color: #633747;
      color: white;
      padding: clamp(0.8em, 3vw, 1.2em);
      text-align: center;
    }


/* Nav links only (keeps underlines in page content) */
.main-nav a,
.dropdown-content a { text-decoration: none; color: inherit; }


/* NAV WRAPPER â€” never create its own scrollbar */

.nav-scroller{
  width:100%;
  overflow-x:hidden;           /* desktop: no sideways scroll */
  overflow-y:visible !important;/* let menus spill over the page */
  position: relative;
  z-index: 20;
}

/* NAV GRID */
.main-nav{
  background:#e8a084;
  display:grid;
  grid-template-columns: repeat(5, minmax(60px, 220px));
  justify-content:center;
  align-items:stretch;
  gap: clamp(6px, .6vw, 6px);
  padding: clamp(6px, 1vw, 10px);
  overflow: visible;           /* <-- important */
}

/* BUTTONS */
.dropdown{ position:relative; min-width:0;}
.dropdown > a{
  display:flex; align-items:center; justify-content:center; text-align:center;
  padding: clamp(6px, 1vw, 6px) clamp(6px, 1vw, 10px);
  font-size: clamp(.9rem, 1vw, 1rem);
  font-weight:bold; color:black; border-radius:6px; line-height:1.4;
  white-space: normal; min-height:44px;
}
.dropdown:hover > a, .dropdown > a:focus-visible{ background:#633747; color:#fff; }

/* DROPDOWN (CSS fallback; JS will float it) */
.dropdown-content{
  display:none;
  position:absolute;           /* fallback if JS fails */
  top:100%;
  left:50%;
  transform:translateX(-50%);
  background:#e8a084;
  z-index:1000; text-align:center;
  font-weight:bold; font-size:clamp(.8rem, .7vw, 1rem);
  padding:.25em 0; border-radius:6px;
  min-width:max(220px, 100%);
  max-width:min(90vw, 30rem);
  z-index:10;    
  box-shadow:0 8px 24px rgba(0,0,0,.18);
}
.dropdown:hover .dropdown-content,
.dropdown:focus-within .dropdown-content{ display:block; }

.dropdown-content a{
  display:block; padding:.55em .7em; line-height:2;
  border-radius:6px; margin:2px 6px; color:black;
}
.dropdown-content a:hover,
.dropdown-content a:focus-visible{ background:#633747; color:#fff; }

:root { --nav-tile-w: 120px; }  /* width that makes labels 2 lines */
@media (max-width: 900px){      /* was 500px */
  .nav-scroller{
    overflow-x:auto; -webkit-overflow-scrolling:touch;
    scrollbar-width:none; overscroll-behavior-x: contain;
  }
  .nav-scroller::-webkit-scrollbar{ width:0; height:0; }

  .main-nav{
    display:grid;
    grid-template-columns: none !important;   /* <-- reset desktop grid */
    grid-auto-flow: column;
    grid-auto-columns: var(--nav-tile-w);     /* fixed tile width */
    width: max-content;
    justify-content: start;
  }

  .dropdown{ min-width:0; }
  .dropdown > a{ width:100%; }                /* anchor fills the tile */
}

/* When JS floats the panel, kill the viewport min-width and the translate */
.dropdown-content.is-floating{
  position: fixed;
  left: 0; top: 0; width: auto; right: auto;
  transform: none !important;   /* cancel the translateX(-50%) from the fallback */
  min-width: 0;                 /* <-- stop 100% viewport min-width */
  max-width: none;              /* let JS width win */
  z-index: 1000;
  box-shadow: 0 8px 24px rgba(0,0,0,.18);
}



   /* --- Main wrapper --- */
    main{
      width: min(100%, 1100px);
      margin-inline: auto;
      padding: clamp(16px, 4vw, 28px);
      text-align: center;
    }
  </style>


  {% if page.is_homepage %}
  <style>
    /* --- Home Page Specific --- */
    .main-section{ padding-block: clamp(10px, 2vw, 18px); }
    .main-section > .docs-container{ margin: clamp(6px, 1vw, 10px) auto; }

    .docs-container{
      width: min(100%, 1000px);
      padding: clamp(12px, 2.2vw, 18px);
      border-radius: 16px;
    }
    .docs-container > :first-child{ margin-top:0; }
    .docs-container > :last-child { margin-bottom:0; }

    .docs-container.prevalence{ background:#ffdc8f; }
    .docs-container.safety-plan{ background:#633747; color:#fff; }
    .docs-container.safety-plan h2{ margin:.2em 0 .3em; }
    .docs-container.safety-plan p{ margin:.2em auto .8em; max-width:72ch; }

    .doc-links{
      display:grid; gap: clamp(10px, 2vw, 18px);
      grid-template-columns: 1fr; justify-items:center; margin-top:.5em;
    }
    @media (min-width:720px){  .doc-links{ grid-template-columns: repeat(2,1fr); } }
    @media (min-width:1024px){ .doc-links{ grid-template-columns: repeat(2,1fr); } }

    .doc-card{
      width:100%; max-width:420px; background:#e8a084; color:#000; border-radius:10px;
      padding: clamp(12px, 2.2vw, 18px); box-shadow:0 2px 6px rgba(0,0,0,.08);
      text-align:center; display:flex; flex-direction:column; gap:.6em;
    }
    .doc-card h3{ margin:.1em 0 .2em; }
    .doc-card p{ margin:.2em 0 .6em; }
    .doc-card a{ margin-top:auto; align-self:center; background:#633747; 
              color:#fff; text-decoration:none; padding:.5em 1em; border-radius:6px; 
              display:inline-block; }
    .doc-card a:hover{ background:#ffdc8f; color:#000; }
  </style>
  {% endif %}
</head>

<body>
  <header>
    <h1>Recognizing power. Reclaiming safety.</h1>
    <p>Practical tools. Powerful boundaries. Safer fieldwork.</p>
  </header>

 <div class="nav-scroller">
  <nav class="main-nav">
    <div class="dropdown"><a href="index.html">Home</a></div>

    <div class="dropdown">
      <a href="{{ site.baseurl }}/preparing.html">Preparing for Fieldwork</a>
      <div class="dropdown-content">
        <a href="#">Beginner Safety Checklist</a>
      </div>
    </div>

    <div class="dropdown">
      <a href="{{ site.baseurl }}/reporting.html">Reporting & Resources</a>
      <div class="dropdown-content">
        <a href="{{ site.baseurl }}/statelaw.html">USA Laws by State</a>
        <a href="{{ site.baseurl }}/internationallaw.html">International Laws by Country</a>
        <a href="{{ site.baseurl }}/titleIX.html">Reporting to Title IX by University</a>
        <a href="{{ site.baseurl }}/fundingethics.html">Reporting to Funders</a>
      </div>
    </div>

    <div class="dropdown">
      <a href="{{ site.baseurl }}/surveys.html">Anonymous Surveys</a>
      <div class="dropdown-content">
        <a href="https://forms.gle/YjAmqWd9xDC5WCJk8" target="_blank">Fieldwork Misconduct Survey</a>
        <a href="https://forms.gle/9DjrMVNP2oUu1GDD8" target="_blank">Website Feedback Survey</a>
      </div>
    </div>

    <div class="dropdown"><a href="{{ site.baseurl }}/contact.html">Contact Us</a></div>
  </nav>
</div>

  <main>
    {{ content }}
  </main>
<script>
(function () {
  const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
  const canHover = window.matchMedia('(hover: hover) and (pointer: fine)').matches;

  document.querySelectorAll('.dropdown').forEach(drop => {
    const btn   = drop.querySelector(':scope > a');
    const panel = drop.querySelector('.dropdown-content');
    if (!btn || !panel) return;

    const show = () => {
      const r = btn.getBoundingClientRect();
      const margin = 12;
      const minW   = 220;                                // keep in sync with CSS
      const maxW   = Math.min(320, window.innerWidth - margin*2);
      const w = clamp(Math.max(r.width, minW), minW, maxW);
      let left = r.left + (r.width/2) - (w/2);
      left = clamp(left, margin, window.innerWidth - margin - w);
      const top = Math.round(r.bottom + window.scrollY);

      panel.classList.add('is-floating');
      panel.style.width = w + 'px';
      panel.style.left  = Math.round(left) + 'px';
      panel.style.top   = top + 'px';
      panel.style.display = 'block';
    };

    const hide = () => {
      panel.style.display = 'none';
      panel.classList.remove('is-floating');
      panel.style.width = panel.style.left = panel.style.top = '';
    };

    // Desktop: open on hover/focus; clicks navigate normally
    drop.addEventListener('mouseenter', show);
    drop.addEventListener('mouseleave', hide);
    btn.addEventListener('focus', show);
    btn.addEventListener('blur', hide);

    // Touch screens: first tap opens, second tap navigates
    if (!canHover) {
      let armed = false;
      btn.addEventListener('click', (e) => {
        if (!armed) {
          e.preventDefault();
          show();
          armed = true;
          setTimeout(() => armed = false, 1200); // auto-cancel after a moment
        } // else: second tap falls through and navigates
      });

      // Tap outside closes and disarms
      document.addEventListener('click', (e) => {
        if (!drop.contains(e.target)) { armed = false; hide(); }
      }, { passive: true });
    }

    // Housekeeping
    window.addEventListener('scroll', hide, { passive: true });
    window.addEventListener('resize', hide);
    btn.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') hide(); });
  });
})();
</script>


</body>
</html>
